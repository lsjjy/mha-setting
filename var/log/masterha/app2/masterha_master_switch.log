$ /usr/local/bin/masterha_master_switch --conf=/etc/masterha/app2/app2.cnf --master_state=alive --orig_master_is_new_slave
Wed Feb 28 21:58:38 2018 - [info] MHA::MasterRotate version 0.56.
Wed Feb 28 21:58:38 2018 - [info] Starting online master switch..
Wed Feb 28 21:58:38 2018 - [info]
Wed Feb 28 21:58:38 2018 - [info] * Phase 1: Configuration Check Phase..
Wed Feb 28 21:58:38 2018 - [info]
Wed Feb 28 21:58:38 2018 - [warning] Global configuration file /etc/masterha_default.cnf not found. Skipping.
Wed Feb 28 21:58:38 2018 - [info] Reading application default configuration from /etc/masterha/app2/app2.cnf..
Wed Feb 28 21:58:38 2018 - [info] Reading server configuration from /etc/masterha/app2/app2.cnf..
Wed Feb 28 21:58:39 2018 - [info] GTID failover mode = 0
Wed Feb 28 21:58:39 2018 - [info] Current Alive Master: 10.252.99.33(10.252.99.33:3307)
Wed Feb 28 21:58:39 2018 - [info] Alive Slaves:
Wed Feb 28 21:58:39 2018 - [info]   10.252.99.32(10.252.99.32:3307)  Version=5.6.38-log (oldest major version between slaves) log-bin:enabled
Wed Feb 28 21:58:39 2018 - [info]     Replicating from test33.sys.cn(10.252.99.33:3307)
Wed Feb 28 21:58:39 2018 - [info]     Primary candidate for the new Master (candidate_master is set)
Wed Feb 28 21:58:39 2018 - [info]   10.252.99.34(10.252.99.34:3307)  Version=5.6.38-log (oldest major version between slaves) log-bin:enabled
Wed Feb 28 21:58:39 2018 - [info]     Replicating from 10.252.99.33(10.252.99.33:3307)
Wed Feb 28 21:58:39 2018 - [info]     Not candidate for the new Master (no_master is set)

It is better to execute FLUSH NO_WRITE_TO_BINLOG TABLES on the master before switching. Is it ok to execute on 10.252.99.33(10.252.99.33:3307)? (YES/no): yes
Wed Feb 28 21:58:41 2018 - [info] Executing FLUSH NO_WRITE_TO_BINLOG TABLES. This may take long time..
Wed Feb 28 21:58:41 2018 - [info]  ok.
Wed Feb 28 21:58:41 2018 - [info] Checking MHA is not monitoring or doing failover..
Wed Feb 28 21:58:41 2018 - [info] Checking replication health on 10.252.99.32..
Wed Feb 28 21:58:41 2018 - [info]  ok.
Wed Feb 28 21:58:41 2018 - [info] Checking replication health on 10.252.99.34..
Wed Feb 28 21:58:41 2018 - [info]  ok.
Wed Feb 28 21:58:41 2018 - [info] Searching new master from slaves..
Wed Feb 28 21:58:41 2018 - [info]  Candidate masters from the configuration file:
Wed Feb 28 21:58:41 2018 - [info]   10.252.99.32(10.252.99.32:3307)  Version=5.6.38-log (oldest major version between slaves) log-bin:enabled
Wed Feb 28 21:58:41 2018 - [info]     Replicating from test33.sys.cn(10.252.99.33:3307)
Wed Feb 28 21:58:41 2018 - [info]     Primary candidate for the new Master (candidate_master is set)
Wed Feb 28 21:58:41 2018 - [info]   10.252.99.33(10.252.99.33:3307)  Version=5.6.24-log log-bin:enabled
Wed Feb 28 21:58:41 2018 - [info]  Non-candidate masters:
Wed Feb 28 21:58:41 2018 - [info]   10.252.99.34(10.252.99.34:3307)  Version=5.6.38-log (oldest major version between slaves) log-bin:enabled
Wed Feb 28 21:58:41 2018 - [info]     Replicating from 10.252.99.33(10.252.99.33:3307)
Wed Feb 28 21:58:41 2018 - [info]     Not candidate for the new Master (no_master is set)
Wed Feb 28 21:58:41 2018 - [info]  Searching from candidate_master slaves which have received the latest relay log events..
Wed Feb 28 21:58:41 2018 - [info]
From:
10.252.99.33(10.252.99.33:3307) (current master)
 +--10.252.99.32(10.252.99.32:3307)
 +--10.252.99.34(10.252.99.34:3307)

To:
10.252.99.32(10.252.99.32:3307) (new master)
 +--10.252.99.34(10.252.99.34:3307)
 +--10.252.99.33(10.252.99.33:3307)

Starting master switch from 10.252.99.33(10.252.99.33:3307) to 10.252.99.32(10.252.99.32:3307)? (yes/NO): yes
Wed Feb 28 21:58:43 2018 - [info] Checking whether 10.252.99.32(10.252.99.32:3307) is ok for the new master..
Wed Feb 28 21:58:43 2018 - [info]  ok.
Wed Feb 28 21:58:43 2018 - [info] 10.252.99.33(10.252.99.33:3307): SHOW SLAVE STATUS returned empty result. To check replication filtering rules, temporarily executing CHANGE MASTER to a dummy host.
Wed Feb 28 21:58:43 2018 - [info] 10.252.99.33(10.252.99.33:3307): Resetting slave pointing to the dummy host.
Wed Feb 28 21:58:43 2018 - [info] ** Phase 1: Configuration Check Phase completed.
Wed Feb 28 21:58:43 2018 - [info]
Wed Feb 28 21:58:43 2018 - [info] * Phase 2: Rejecting updates Phase..
Wed Feb 28 21:58:43 2018 - [info]
Wed Feb 28 21:58:43 2018 - [info] Executing master ip online change script to disable write on the current master:
Wed Feb 28 21:58:43 2018 - [info]   /etc/masterha/app2/scripts/master_ip_online_change --command=stop --orig_master_host=10.252.99.33 --orig_master_ip=10.252.99.33 --orig_master_port=3307 --orig_master_user='mha_mgr' --orig_master_password='mha_mgr' --new_master_host=10.252.99.32 --new_master_ip=10.252.99.32 --new_master_port=3307 --new_master_user='mha_mgr' --new_master_password='mha_mgr' --orig_master_ssh_user=mysql --new_master_ssh_user=mysql   --orig_master_is_new_slave
ARGS: $VAR1 = [
          '--command=stop',
          '--orig_master_host=10.252.99.33',
          '--orig_master_ip=10.252.99.33',
          '--orig_master_port=3307',
          '--orig_master_user=mha_mgr',
          '--orig_master_password=mha_mgr',
          '--new_master_host=10.252.99.32',
          '--new_master_ip=10.252.99.32',
          '--new_master_port=3307',
          '--new_master_user=mha_mgr',
          '--new_master_password=mha_mgr',
          '--orig_master_ssh_user=mysql',
          '--new_master_ssh_user=mysql',
          '--orig_master_is_new_slave'
        ];
Unknown option: orig_master_ssh_user
Unknown option: new_master_ssh_user
Unknown option: orig_master_is_new_slave
Wed Feb 28 21:58:43 2018 653970 Set read_only on the new master.. ok.
RTNETLINK answers: Cannot assign requested address
bind: Cannot assign requested address
Wed Feb 28 21:58:43 2018 752031 Set read_only=1 on the orig master.. ok.
Wed Feb 28 21:58:43 2018 753995 Killing all application threads..
Wed Feb 28 21:58:43 2018 754018 done.
STOP ARGS: $VAR1 = [];
Wed Feb 28 21:58:43 2018 - [info]  ok.
Wed Feb 28 21:58:43 2018 - [info] Locking all tables on the orig master to reject updates from everybody (including root):
Wed Feb 28 21:58:43 2018 - [info] Executing FLUSH TABLES WITH READ LOCK..
Wed Feb 28 21:58:43 2018 - [info]  ok.
Wed Feb 28 21:58:43 2018 - [info] Orig master binlog:pos is mysql_bin.000003:120.
Wed Feb 28 21:58:43 2018 - [info]  Waiting to execute all relay logs on 10.252.99.32(10.252.99.32:3307)..
Wed Feb 28 21:58:43 2018 - [info]  master_pos_wait(mysql_bin.000003:120) completed on 10.252.99.32(10.252.99.32:3307). Executed 0 events.
Wed Feb 28 21:58:43 2018 - [info]   done.
Wed Feb 28 21:58:43 2018 - [info] Getting new master's binlog name and position..
Wed Feb 28 21:58:43 2018 - [info]  mysql_bin.000004:120
Wed Feb 28 21:58:43 2018 - [info]  All other slaves should start replication from here. Statement should be: CHANGE MASTER TO MASTER_HOST='10.252.99.32', MASTER_PORT=3307, MASTER_LOG_FILE='mysql_bin.000004', MASTER_LOG_POS=120, MASTER_USER='repl', MASTER_PASSWORD='xxx';
Wed Feb 28 21:58:43 2018 - [info] Executing master ip online change script to allow write on the new master:
Wed Feb 28 21:58:43 2018 - [info]   /etc/masterha/app2/scripts/master_ip_online_change --command=start --orig_master_host=10.252.99.33 --orig_master_ip=10.252.99.33 --orig_master_port=3307 --orig_master_user='mha_mgr' --orig_master_password='mha_mgr' --new_master_host=10.252.99.32 --new_master_ip=10.252.99.32 --new_master_port=3307 --new_master_user='mha_mgr' --new_master_password='mha_mgr' --orig_master_ssh_user=mysql --new_master_ssh_user=mysql   --orig_master_is_new_slave
ARGS: $VAR1 = [
          '--command=start',
          '--orig_master_host=10.252.99.33',
          '--orig_master_ip=10.252.99.33',
          '--orig_master_port=3307',
          '--orig_master_user=mha_mgr',
          '--orig_master_password=mha_mgr',
          '--new_master_host=10.252.99.32',
          '--new_master_ip=10.252.99.32',
          '--new_master_port=3307',
          '--new_master_user=mha_mgr',
          '--new_master_password=mha_mgr',
          '--orig_master_ssh_user=mysql',
          '--new_master_ssh_user=mysql',
          '--orig_master_is_new_slave'
        ];
Unknown option: orig_master_ssh_user
Unknown option: new_master_ssh_user
Unknown option: orig_master_is_new_slave
Wed Feb 28 21:58:43 2018 839530 Set read_only=0 on the new master.
RTNETLINK answers: File exists
Wed Feb 28 21:58:43 2018 - [info]  ok.
Wed Feb 28 21:58:43 2018 - [info]
Wed Feb 28 21:58:43 2018 - [info] * Switching slaves in parallel..
Wed Feb 28 21:58:43 2018 - [info]
Wed Feb 28 21:58:43 2018 - [info] -- Slave switch on host 10.252.99.34(10.252.99.34:3307) started, pid: 373
Wed Feb 28 21:58:43 2018 - [info]
Wed Feb 28 21:58:44 2018 - [info] Log messages from 10.252.99.34 ...
Wed Feb 28 21:58:44 2018 - [info]
Wed Feb 28 21:58:43 2018 - [info]  Waiting to execute all relay logs on 10.252.99.34(10.252.99.34:3307)..
Wed Feb 28 21:58:43 2018 - [info]  master_pos_wait(mysql_bin.000003:120) completed on 10.252.99.34(10.252.99.34:3307). Executed 0 events.
Wed Feb 28 21:58:43 2018 - [info]   done.
Wed Feb 28 21:58:43 2018 - [info]  Resetting slave 10.252.99.34(10.252.99.34:3307) and starting replication from the newmaster 10.252.99.32(10.252.99.32:3307)..
Wed Feb 28 21:58:43 2018 - [info]  Executed CHANGE MASTER.
Wed Feb 28 21:58:43 2018 - [info]  Slave started.
Wed Feb 28 21:58:44 2018 - [info] End of log messages from 10.252.99.34 ...
Wed Feb 28 21:58:44 2018 - [info]
Wed Feb 28 21:58:44 2018 - [info] -- Slave switch on host 10.252.99.34(10.252.99.34:3307) succeeded.
Wed Feb 28 21:58:44 2018 - [info] Unlocking all tables on the orig master:
Wed Feb 28 21:58:44 2018 - [info] Executing UNLOCK TABLES..
Wed Feb 28 21:58:44 2018 - [info]  ok.
Wed Feb 28 21:58:44 2018 - [info] Starting orig master as a new slave..
Wed Feb 28 21:58:44 2018 - [info]  Resetting slave 10.252.99.33(10.252.99.33:3307) and starting replication from the newmaster 10.252.99.32(10.252.99.32:3307)..
Wed Feb 28 21:58:44 2018 - [info]  Executed CHANGE MASTER.
Wed Feb 28 21:58:44 2018 - [info]  Slave started.
Wed Feb 28 21:58:44 2018 - [info] All new slave servers switched successfully.
Wed Feb 28 21:58:44 2018 - [info]
Wed Feb 28 21:58:44 2018 - [info] * Phase 5: New master cleanup phase..
Wed Feb 28 21:58:44 2018 - [info]
Wed Feb 28 21:58:44 2018 - [info]  10.252.99.32: Resetting slave info succeeded.
Wed Feb 28 21:58:44 2018 - [info] Switching master to 10.252.99.32(10.252.99.32:3307) completed successfully.
